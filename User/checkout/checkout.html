<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FoodHub - My Orders</title>
    <link rel="stylesheet" href="../style.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f7f7f7;
        margin: 0;
        padding: 0;
      }

      /* Navigation Bar */

      .logo {
        font-weight: bold;
        font-size: 24px;
        color: #333;
      }

      .account-btn {
        background-color: #ff5a5f;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      /* Orders Section */
      .orders-container {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .orders-main {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .orders-main h2 {
        font-size: 24px;
        color: #333;
        margin-bottom: 20px;
      }

      /* Order Card */
      .order-card {
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        padding: 20px;
        transition: all 0.3s ease-in-out;
      }

      .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .order-id {
        font-weight: bold;
        color: #333;
      }

      .order-date {
        color: #777;
        font-size: 14px;
      }

      .order-info {
        margin-top: 15px;
      }

      .order-info p {
        font-size: 16px;
        margin: 5px 0;
      }

      /* Status Badge */
      .order-status {
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 14px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .order-status.pending {
        background-color: #ffcc00;
        color: #fff;
      }

      .order-status.completed {
        background-color: #28a745;
        color: #fff;
      }

      /* View Order Button */
      .view-order-btn {
        background-color: #ff5a5f;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 15px;
      }

      .view-order-btn:hover {
        background-color: #ff3d3d;
      }

      /* Order Item Details */
      .order-items {
        margin-top: 15px;
        font-size: 14px;
        color: #333;
      }

      .order-items ul {
        padding-left: 20px;
        list-style-type: none;
      }

      .order-items li {
        padding: 8px 0;
        border-bottom: 1px solid #ddd;
      }

      .order-items li:last-child {
        border-bottom: none;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .navbar {
          flex-direction: column;
          align-items: flex-start;
        }

        .nav-links {
          flex-direction: column;
        }

        .order-card {
          margin-bottom: 10px;
        }
      }
    </style>
  </head>

  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="logo">FoodHub</div>
      <ul class="nav-links">
        <li><a href="../homepage/menu.php">HOME</a></li>

        <li><a href="/">MY ORDERS</a></li>
        <li><a href="../cart/cart.html">CART</a></li>
      </ul>
      <button class="account-btn" id="accountBtn">MY ACCOUNT</button>
    </nav>

    <!-- Orders Content -->
    <div class="orders-container">
      <div class="orders-main">
        <h2>Your Orders</h2>

        <div id="orders-list">
          <!-- Orders will be dynamically injected here -->
        </div>
      </div>
    </div>

    <script>
      // --- Auth Check ---
      if (localStorage.getItem("isLoggedIn") !== "true") {
        window.location.href = "../login/login.html";
      }

      // --- Get User Info ---
      const user = JSON.parse(localStorage.getItem("user") || "{}");

      // --- Fetch Orders ---
      fetch(`../checkout/orders.php?email=${encodeURIComponent(user.email)}`)
        .then((res) => res.json())
        .then((data) => {
          if (!data.success) {
            alert("Unable to load orders: " + data.message);
            return;
          }

          // If no orders, show a message
          if (data.orders.length === 0) {
            document.getElementById("orders-list").innerHTML = `
        <p>You have no orders yet. Browse the <a href="../homepage/menu.php">menu</a> and place an order!</p>
      `;
            return;
          }

          // Loop through orders and render them
          data.orders.forEach((order) => {
            const orderDiv = document.createElement("div");
            orderDiv.className = "order-card";
            orderDiv.innerHTML = `
        <div class="order-header">
          <span class="order-id">Order #${order.id}</span>
        </div>
        <div class="order-info">
          <p><strong>Total:</strong> $${order.total}</p>
          <p><strong>Status:</strong> <span class="order-status ${order.order_status.toLowerCase()}">${
              order.order_status
            }</span></p>
        </div>
      `;

            // Check if items exist for this order
            if (order.items && Array.isArray(order.items) && order.items.length > 0) {
              const orderItemsHtml = order.items
                .map(
                  (item) => `
          <li>
            <div><strong>${item.product_name}</strong> - $${item.unit_price} x ${item.quantity}</div>
          </li>
        `
                )
                .join("");

              orderDiv.innerHTML += `
          <div class="order-items">
            <h4>Order Items</h4>
            <ul>
              ${orderItemsHtml}
            </ul>
          </div>
        `;
            } else {
              orderDiv.innerHTML += `
          <div class="order-items">
            <p>No items available for this order.</p>
          </div>
        `;
            }

            // Append to orders list
            document.getElementById("orders-list").appendChild(orderDiv);
          });
        })
        .catch((err) => {
          console.error("Error fetching orders:", err);
          alert("Error loading orders.");
        });

      // --- Navbar Account Button Logic ---
      const accountBtn = document.getElementById("accountBtn");
      if (accountBtn) {
        const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
        if (isLoggedIn) {
          const rawUser = localStorage.getItem("user");
          let username = "Account";
          if (rawUser) {
            try {
              const u = JSON.parse(rawUser);
              if (u && u.name) {
                username = u.name.split(" ")[0];
              }
            } catch (e) {}
          }
          accountBtn.textContent = username;
          accountBtn.addEventListener("click", () => {
            window.location.href = "../account/account.html";
          });
        } else {
          accountBtn.textContent = "LOGIN";
          accountBtn.addEventListener("click", () => {
            window.location.href = "../login/login.html";
          });
        }
      }
    </script>
  </body>
</html>
